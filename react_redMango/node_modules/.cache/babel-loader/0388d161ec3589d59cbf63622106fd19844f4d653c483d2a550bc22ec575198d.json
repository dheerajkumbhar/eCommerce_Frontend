{"ast":null,"code":"import{useStripe,useElements,PaymentElement}from\"@stripe/react-stripe-js\";import{useState}from\"react\";import{useCreateOrderMutation}from\"../../../Apis/orderApi\";import{toastNotify}from\"../../../Helper\";import{SD_Status}from\"../../../Utility/SD\";import{useNavigate}from\"react-router\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PaymentForm=_ref=>{let{data,userInput}=_ref;const navigate=useNavigate();const stripe=useStripe();const elements=useElements();const[createOrder]=useCreateOrderMutation();const[isProcessing,setIsProcessing]=useState(false);const handleSubmit=async event=>{event.preventDefault();if(!stripe||!elements){return;}setIsProcessing(true);const result=await stripe.confirmPayment({//`Elements` instance that was used to create the Payment Element\nelements,confirmParams:{return_url:\"https://example.com/order/123/complete\"},redirect:\"if_required\"});if(result.error){// Show error to your customer (for example, payment details incomplete)\ntoastNotify(\"An unexpected error occured.\",\"error\");setIsProcessing(false);}else{var _data$cartItems;let grandTotal=0;let totalItems=0;const orderDetailsDTO=[];(_data$cartItems=data.cartItems)===null||_data$cartItems===void 0?void 0:_data$cartItems.forEach(item=>{var _item$menuItem,_item$menuItem2,_item$menuItem3,_item$menuItem4;const tempOrderDetail={};tempOrderDetail[\"menuItemId\"]=(_item$menuItem=item.menuItem)===null||_item$menuItem===void 0?void 0:_item$menuItem.id;tempOrderDetail[\"quantity\"]=item.quantity;tempOrderDetail[\"itemName\"]=(_item$menuItem2=item.menuItem)===null||_item$menuItem2===void 0?void 0:_item$menuItem2.name;tempOrderDetail[\"price\"]=(_item$menuItem3=item.menuItem)===null||_item$menuItem3===void 0?void 0:_item$menuItem3.price;orderDetailsDTO.push(tempOrderDetail);grandTotal+=item.quantity*((_item$menuItem4=item.menuItem)===null||_item$menuItem4===void 0?void 0:_item$menuItem4.price);totalItems+=item.quantity;});const response=await createOrder({pickupName:userInput.name,pickupPhoneNumber:userInput.phoneNumber,pickupEmail:userInput.email,totalItems:totalItems,orderTotal:grandTotal,orderDetailsDTO:orderDetailsDTO,stripePaymentIntentID:data.stripePaymentIntentId,applicationUserId:data.userId,status:result.paymentIntent.status===\"succeeded\"?SD_Status.CONFIRMED:SD_Status.PENDING});if(response){var _response$data;if(((_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.result.status)===SD_Status.CONFIRMED){navigate(\"/order/orderConfirmed/\".concat(response.data.result.orderHeaderId));}else{navigate(\"/failed\");}}}setIsProcessing(false);};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(PaymentElement,{}),/*#__PURE__*/_jsx(\"button\",{disabled:!stripe||isProcessing,className:\"btn btn-success mt-5 w-100\",children:/*#__PURE__*/_jsx(\"span\",{id:\"button-text\",children:isProcessing?\"Processing ... \":\"Submit Order\"})})]});};export default PaymentForm;","map":{"version":3,"names":["useStripe","useElements","PaymentElement","useState","useCreateOrderMutation","toastNotify","SD_Status","useNavigate","jsx","_jsx","jsxs","_jsxs","PaymentForm","_ref","data","userInput","navigate","stripe","elements","createOrder","isProcessing","setIsProcessing","handleSubmit","event","preventDefault","result","confirmPayment","confirmParams","return_url","redirect","error","_data$cartItems","grandTotal","totalItems","orderDetailsDTO","cartItems","forEach","item","_item$menuItem","_item$menuItem2","_item$menuItem3","_item$menuItem4","tempOrderDetail","menuItem","id","quantity","name","price","push","response","pickupName","pickupPhoneNumber","phoneNumber","pickupEmail","email","orderTotal","stripePaymentIntentID","stripePaymentIntentId","applicationUserId","userId","status","paymentIntent","CONFIRMED","PENDING","_response$data","concat","orderHeaderId","onSubmit","children","disabled","className"],"sources":["C:/redmango_frontend/react_redMango/src/Components/Page/Payment/PaymentForm.tsx"],"sourcesContent":["import {\r\n  useStripe,\r\n  useElements,\r\n  PaymentElement,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { useState } from \"react\";\r\nimport { useCreateOrderMutation } from \"../../../Apis/orderApi\";\r\nimport { toastNotify } from \"../../../Helper\";\r\nimport { apiResponse, cartItemModel } from \"../../../Interfaces\";\r\nimport { SD_Status } from \"../../../Utility/SD\";\r\nimport { orderSummaryProps } from \"../Order/orderSummaryProps\";\r\nimport { useNavigate } from \"react-router\";\r\n\r\nconst PaymentForm = ({ data, userInput }: orderSummaryProps) => {\r\n  const navigate = useNavigate();\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const [createOrder] = useCreateOrderMutation();\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n\r\n    if (!stripe || !elements) {\r\n      return;\r\n    }\r\n    setIsProcessing(true);\r\n    const result = await stripe.confirmPayment({\r\n      //`Elements` instance that was used to create the Payment Element\r\n      elements,\r\n      confirmParams: {\r\n        return_url: \"https://example.com/order/123/complete\",\r\n      },\r\n      redirect: \"if_required\",\r\n    });\r\n\r\n    if (result.error) {\r\n      // Show error to your customer (for example, payment details incomplete)\r\n      toastNotify(\"An unexpected error occured.\", \"error\");\r\n      setIsProcessing(false);\r\n    } else {\r\n      let grandTotal = 0;\r\n      let totalItems = 0;\r\n      const orderDetailsDTO: any = [];\r\n      data.cartItems?.forEach((item: cartItemModel) => {\r\n        const tempOrderDetail: any = {};\r\n        tempOrderDetail[\"menuItemId\"] = item.menuItem?.id;\r\n        tempOrderDetail[\"quantity\"] = item.quantity;\r\n        tempOrderDetail[\"itemName\"] = item.menuItem?.name;\r\n        tempOrderDetail[\"price\"] = item.menuItem?.price;\r\n        orderDetailsDTO.push(tempOrderDetail);\r\n        grandTotal += item.quantity! * item.menuItem?.price!;\r\n        totalItems += item.quantity!;\r\n      });\r\n\r\n      const response: apiResponse = await createOrder({\r\n        pickupName: userInput.name,\r\n        pickupPhoneNumber: userInput.phoneNumber,\r\n        pickupEmail: userInput.email,\r\n        totalItems: totalItems,\r\n        orderTotal: grandTotal,\r\n        orderDetailsDTO: orderDetailsDTO,\r\n        stripePaymentIntentID: data.stripePaymentIntentId,\r\n        applicationUserId: data.userId,\r\n        status:\r\n          result.paymentIntent.status === \"succeeded\"\r\n            ? SD_Status.CONFIRMED\r\n            : SD_Status.PENDING,\r\n      });\r\n\r\n      if (response) {\r\n        if (response.data?.result.status === SD_Status.CONFIRMED) {\r\n          navigate(\r\n            `/order/orderConfirmed/${response.data.result.orderHeaderId}`\r\n          );\r\n        } else {\r\n          navigate(\"/failed\");\r\n        }\r\n      }\r\n    }\r\n    setIsProcessing(false);\r\n  };\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <PaymentElement />\r\n      <button\r\n        disabled={!stripe || isProcessing}\r\n        className=\"btn btn-success mt-5 w-100\"\r\n      >\r\n        <span id=\"button-text\">\r\n          {isProcessing ? \"Processing ... \" : \"Submit Order\"}\r\n        </span>\r\n      </button>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default PaymentForm;\r\n"],"mappings":"AAAA,OACEA,SAAS,CACTC,WAAW,CACXC,cAAc,KACT,yBAAyB,CAChC,OAASC,QAAQ,KAAQ,OAAO,CAChC,OAASC,sBAAsB,KAAQ,wBAAwB,CAC/D,OAASC,WAAW,KAAQ,iBAAiB,CAE7C,OAASC,SAAS,KAAQ,qBAAqB,CAE/C,OAASC,WAAW,KAAQ,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE3C,KAAM,CAAAC,WAAW,CAAGC,IAAA,EAA4C,IAA3C,CAAEC,IAAI,CAAEC,SAA6B,CAAC,CAAAF,IAAA,CACzD,KAAM,CAAAG,QAAQ,CAAGT,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAU,MAAM,CAAGjB,SAAS,CAAC,CAAC,CAC1B,KAAM,CAAAkB,QAAQ,CAAGjB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAACkB,WAAW,CAAC,CAAGf,sBAAsB,CAAC,CAAC,CAC9C,KAAM,CAACgB,YAAY,CAAEC,eAAe,CAAC,CAAGlB,QAAQ,CAAC,KAAK,CAAC,CACvD,KAAM,CAAAmB,YAAY,CAAG,KAAO,CAAAC,KAAuC,EAAK,CACtEA,KAAK,CAACC,cAAc,CAAC,CAAC,CAEtB,GAAI,CAACP,MAAM,EAAI,CAACC,QAAQ,CAAE,CACxB,OACF,CACAG,eAAe,CAAC,IAAI,CAAC,CACrB,KAAM,CAAAI,MAAM,CAAG,KAAM,CAAAR,MAAM,CAACS,cAAc,CAAC,CACzC;AACAR,QAAQ,CACRS,aAAa,CAAE,CACbC,UAAU,CAAE,wCACd,CAAC,CACDC,QAAQ,CAAE,aACZ,CAAC,CAAC,CAEF,GAAIJ,MAAM,CAACK,KAAK,CAAE,CAChB;AACAzB,WAAW,CAAC,8BAA8B,CAAE,OAAO,CAAC,CACpDgB,eAAe,CAAC,KAAK,CAAC,CACxB,CAAC,IAAM,KAAAU,eAAA,CACL,GAAI,CAAAC,UAAU,CAAG,CAAC,CAClB,GAAI,CAAAC,UAAU,CAAG,CAAC,CAClB,KAAM,CAAAC,eAAoB,CAAG,EAAE,CAC/B,CAAAH,eAAA,CAAAjB,IAAI,CAACqB,SAAS,UAAAJ,eAAA,iBAAdA,eAAA,CAAgBK,OAAO,CAAEC,IAAmB,EAAK,KAAAC,cAAA,CAAAC,eAAA,CAAAC,eAAA,CAAAC,eAAA,CAC/C,KAAM,CAAAC,eAAoB,CAAG,CAAC,CAAC,CAC/BA,eAAe,CAAC,YAAY,CAAC,EAAAJ,cAAA,CAAGD,IAAI,CAACM,QAAQ,UAAAL,cAAA,iBAAbA,cAAA,CAAeM,EAAE,CACjDF,eAAe,CAAC,UAAU,CAAC,CAAGL,IAAI,CAACQ,QAAQ,CAC3CH,eAAe,CAAC,UAAU,CAAC,EAAAH,eAAA,CAAGF,IAAI,CAACM,QAAQ,UAAAJ,eAAA,iBAAbA,eAAA,CAAeO,IAAI,CACjDJ,eAAe,CAAC,OAAO,CAAC,EAAAF,eAAA,CAAGH,IAAI,CAACM,QAAQ,UAAAH,eAAA,iBAAbA,eAAA,CAAeO,KAAK,CAC/Cb,eAAe,CAACc,IAAI,CAACN,eAAe,CAAC,CACrCV,UAAU,EAAIK,IAAI,CAACQ,QAAQ,GAAAJ,eAAA,CAAIJ,IAAI,CAACM,QAAQ,UAAAF,eAAA,iBAAbA,eAAA,CAAeM,KAAK,CAAC,CACpDd,UAAU,EAAII,IAAI,CAACQ,QAAS,CAC9B,CAAC,CAAC,CAEF,KAAM,CAAAI,QAAqB,CAAG,KAAM,CAAA9B,WAAW,CAAC,CAC9C+B,UAAU,CAAEnC,SAAS,CAAC+B,IAAI,CAC1BK,iBAAiB,CAAEpC,SAAS,CAACqC,WAAW,CACxCC,WAAW,CAAEtC,SAAS,CAACuC,KAAK,CAC5BrB,UAAU,CAAEA,UAAU,CACtBsB,UAAU,CAAEvB,UAAU,CACtBE,eAAe,CAAEA,eAAe,CAChCsB,qBAAqB,CAAE1C,IAAI,CAAC2C,qBAAqB,CACjDC,iBAAiB,CAAE5C,IAAI,CAAC6C,MAAM,CAC9BC,MAAM,CACJnC,MAAM,CAACoC,aAAa,CAACD,MAAM,GAAK,WAAW,CACvCtD,SAAS,CAACwD,SAAS,CACnBxD,SAAS,CAACyD,OAClB,CAAC,CAAC,CAEF,GAAId,QAAQ,CAAE,KAAAe,cAAA,CACZ,GAAI,EAAAA,cAAA,CAAAf,QAAQ,CAACnC,IAAI,UAAAkD,cAAA,iBAAbA,cAAA,CAAevC,MAAM,CAACmC,MAAM,IAAKtD,SAAS,CAACwD,SAAS,CAAE,CACxD9C,QAAQ,0BAAAiD,MAAA,CACmBhB,QAAQ,CAACnC,IAAI,CAACW,MAAM,CAACyC,aAAa,CAC7D,CAAC,CACH,CAAC,IAAM,CACLlD,QAAQ,CAAC,SAAS,CAAC,CACrB,CACF,CACF,CACAK,eAAe,CAAC,KAAK,CAAC,CACxB,CAAC,CACD,mBACEV,KAAA,SAAMwD,QAAQ,CAAE7C,YAAa,CAAA8C,QAAA,eAC3B3D,IAAA,CAACP,cAAc,GAAE,CAAC,cAClBO,IAAA,WACE4D,QAAQ,CAAE,CAACpD,MAAM,EAAIG,YAAa,CAClCkD,SAAS,CAAC,4BAA4B,CAAAF,QAAA,cAEtC3D,IAAA,SAAMmC,EAAE,CAAC,aAAa,CAAAwB,QAAA,CACnBhD,YAAY,CAAG,iBAAiB,CAAG,cAAc,CAC9C,CAAC,CACD,CAAC,EACL,CAAC,CAEX,CAAC,CAED,cAAe,CAAAR,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}